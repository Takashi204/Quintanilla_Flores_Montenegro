<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel SYSADMIN ‚Äî MiCaja POS</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS general -->
    <link rel="stylesheet" href="assets/style.css">
</head>

<!-- 
    El onload ejecuta:
    - guardSysAdmin()   (protege acceso)
    - cargarDatos()     (muestra nombre)
    - renderUsuarios()  (lista CRUD)
    - cargarParametros() (carga URL + modo)
-->
<body class="bg-dark text-light"
      onload="guardSysAdmin(); cargarDatos(); renderUsuarios(); cargarParametros();">

<nav class="navbar navbar-dark bg-black px-3">
    <span class="navbar-brand">MiCaja POS ‚Äî SYSADMIN</span>
    <span id="usuarioSys" class="me-3 small text-info"></span>
    <button class="btn btn-sm btn-outline-light" onclick="logoutSysAdmin()">Cerrar sesi√≥n</button>
</nav>

<div class="container-fluid mt-4">
    <div class="row">

        <!-- Sidebar -->
        <div class="col-12 col-md-3 mb-3">
            <div class="list-group">
                <button class="list-group-item list-group-item-action active"
                        id="btnSecUsuarios"
                        onclick="mostrarSeccion('usuarios')">
                    üë• Usuarios
                </button>

                <button class="list-group-item list-group-item-action"
                        id="btnSecParametros"
                        onclick="mostrarSeccion('parametros')">
                    ‚öôÔ∏è Par√°metros del sistema
                </button>

                <button class="list-group-item list-group-item-action"
                        id="btnSecApi"
                        onclick="mostrarSeccion('api')">
                    üåê Conexi√≥n / Endpoints
                </button>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="col-12 col-md-9">

            <!-- ======================== -->
            <!--     SECCI√ìN USUARIOS     -->
            <!-- ======================== -->
            <div id="sec-usuarios">

                <h3>Administraci√≥n de usuarios</h3>
                <p class="text-secondary">Crea, elimina y gestiona usuarios del sistema.</p>

                <!-- FORMULARIO CREAR USUARIO -->
                <div class="card bg-black p-3 mb-4">
                    <h5>Crear usuario</h5>

                    <div class="row mt-2">
                        <div class="col-md-4">
                            <label class="form-label">Usuario</label>
                            <input id="newUser" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Contrase√±a</label>
                            <input id="newPass" type="password" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Rol</label>
                            <select id="newRol" class="form-select">
                                <option value="ADMIN">ADMIN</option>
                                <option value="CAJERO">CAJERO</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary mt-3" onclick="crearUsuario()">Crear usuario</button>
                </div>

                <!-- TABLA DE USUARIOS -->
                <div class="card bg-black p-3">
                    <h5>Lista de usuarios</h5>

                    <table class="table table-dark table-striped table-sm mt-3">
                        <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th style="width:120px;">Acciones</th>
                        </tr>
                        </thead>

                        <tbody id="tablaUsuarios"></tbody>
                    </table>
                </div>

            </div>

            <!-- ============================== -->
            <!--   SECCI√ìN: PAR√ÅMETROS SISTEMA  -->
            <!-- ============================== -->
            <div id="sec-parametros" class="d-none">

                <h3>Par√°metros del sistema</h3>
                <p class="text-secondary">
                    Aqu√≠ puedes configurar c√≥mo se conecta MiCaja POS:<br>
                    ‚Ä¢ Local (SQLite)  
                    ‚Ä¢ Web (API de tu compa√±ero)
                </p>

                <!-- FORMULARIO CONFIG -->
                <form class="mt-3" onsubmit="guardarParametros(); return false;">

                    <div class="mb-3">
                        <label class="form-label fw-bold">URL backend API</label>
                        <input id="cfg_api" class="form-control" placeholder="https://backend.com/api">
                        <small class="text-secondary">Ejemplo: https://mipos.duoc/api</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Modo del sistema</label>
                        <select id="cfg_modo" class="form-select">
                            <option value="local">Local (SQLite)</option>
                            <option value="web">Web (API remota)</option>
                        </select>
                    </div>

                    <button class="btn btn-primary mt-2" type="submit">Guardar par√°metros</button>
                </form>

                <div class="alert alert-info small mt-3">
                    ‚ÑπÔ∏è Cuando tu compa√±ero entregue el backend, tus componentes usar√°n esta URL
                    y este modo para conectarse.
                </div>

            </div>

            <!-- ============================== -->
            <!--   SECCI√ìN: API (TEST FUTURO)   -->
            <!-- ============================== -->
            <div id="sec-api" class="d-none">
                <h3>Conexi√≥n / Endpoints</h3>
                <p class="text-secondary">
                    Esta secci√≥n permitir√° probar los endpoints reales.
                    Cuando tu compa√±ero tenga la API, aqu√≠ ir√°n los botones de pruebas.
                </p>
            </div>

        </div>
    </div>
</div>

<!-- JS Principal -->
<script src="js/sysadmin.js"></script>

<!-- JS CRUD de usuarios -->
<script src="js/sysadmin-users.js"></script>

<!-- JS Configuraci√≥n (modo web/local + URL backend) -->
<script src="js/sysadmin-config.js"></script>

<script>
    // ==============================
    // Mostrar nombre del usuario
    // ==============================
    function cargarDatos() {
        const u = JSON.parse(localStorage.getItem("pos_user") || "null");
        document.getElementById("usuarioSys").textContent =
            u?.user ? ("SYSADMIN ¬∑ " + u.user) : "SYSADMIN";
    }

    // ==============================
    // Cargar par√°metros (modo + URL)
    // ==============================
    function cargarParametros() {
        const cfg = getConfig(); // viene de sysadmin-config.js
        document.getElementById("cfg_api").value  = cfg.url_api;
        document.getElementById("cfg_modo").value = cfg.modo;
    }

    // ==============================
    // Manejo de secciones visuales
    // ==============================
    function mostrarSeccion(sec) {
        const secciones = ["usuarios", "parametros", "api"];

        secciones.forEach(s => {
            document.getElementById("sec-" + s).classList.add("d-none");
            document.getElementById("btnSec" + s.charAt(0).toUpperCase() + s.slice(1)).classList.remove("active");
        });

        document.getElementById("sec-" + sec).classList.remove("d-none");
        document.getElementById("btnSec" + sec.charAt(0).toUpperCase() + sec.slice(1)).classList.add("active");
    }
</script>

</body>
</html>
